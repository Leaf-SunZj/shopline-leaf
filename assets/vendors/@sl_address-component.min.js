!function(){"use strict";(_=D||(D={})).Country="country",_.Province="province",_.City="city",_.District="district",_.Name="name",_.FirstName="firstName",_.LastName="lastName",_.Mobile="mobile",_.Postcode="postcode",_.Company="company",_.Address="address",_.Address2="address2",(P=B||(B={}))[P.NAME=1]="NAME",P[P.FLName=2]="FLName",(E=k||(k={}))[E.Select=1]="Select",E[E.Input=2]="Input";let e=[D.Country,D.Province,D.City,D.District,D.Name,D.FirstName,D.LastName,D.Mobile,D.Postcode,D.Address,D.Address2,D.Company],t=Symbol("@ts-pattern/matcher"),r="@ts-pattern/anonymous-select-key",n=e=>Boolean(e&&"object"==typeof e),i=e=>e&&!!e[t],o=(e,r,a)=>{if(n(e)){if(i(e)){let l=e[t](),{matched:d,selections:u={}}=l.match(r);return d&&Object.keys(u).forEach(e=>a(e,u[e])),d}if(!n(r))return!1;if(Array.isArray(e))return!!Array.isArray(r)&&e.length===r.length&&e.every((e,t)=>o(e,r[t],a));if(e instanceof Map)return r instanceof Map&&Array.from(e.keys()).every(t=>o(e.get(t),r.get(t),a));if(e instanceof Set){if(!(r instanceof Set))return!1;if(0===e.size)return 0===r.size;if(1===e.size){let[s]=Array.from(e.values());return i(s)?Array.from(r.values()).every(e=>o(s,e,a)):r.has(s)}return Array.from(e.values()).every(e=>r.has(e))}return Object.keys(e).every(n=>{let l=e[n];return(n in r||i(l)&&"optional"===l[t]().matcherType)&&o(l,r[n],a)})}return Object.is(r,e)},a=e=>{var r,o,d;return n(e)?i(e)?null!=(r=null==(o=(d=e[t]()).getSelectionKeys)?void 0:o.call(d))?r:[]:Array.isArray(e)?l(e,a):l(Object.values(e),a):[]},l=(e,t)=>e.reduce((e,r)=>e.concat(t(r)),[]);function d(e){return{[t]:()=>({match(t){let r={},n=(e,t)=>{r[e]=t};return void 0===t?(a(e).forEach(e=>n(e,void 0)),{matched:!0,selections:r}):{matched:o(e,t,n),selections:r}},getSelectionKeys:()=>a(e),matcherType:"optional"})}}function u(e){return{[t]:()=>({match(t){if(!Array.isArray(t))return{matched:!1};let r={},n=(e,t)=>{r[e]=(r[e]||[]).concat([t])};return{matched:t.every(t=>o(e,t,n)),selections:r}},getSelectionKeys:()=>a(e)})}}function s(...e){return{[t]:()=>({match(t){let r={},n=(e,t)=>{r[e]=t};return{matched:e.every(e=>o(e,t,n)),selections:r}},getSelectionKeys:()=>l(e,a),matcherType:"and"})}}function c(...e){return{[t]:()=>({match(t){let r={},n=(e,t)=>{r[e]=t};return l(e,a).forEach(e=>n(e,void 0)),{matched:e.some(e=>o(e,t,n)),selections:r}},getSelectionKeys:()=>l(e,a),matcherType:"or"})}}function p(e){return{[t]:()=>({match:t=>({matched:!o(e,t,()=>{})}),getSelectionKeys:()=>[],matcherType:"not"})}}function f(e){return{[t]:()=>({match:t=>({matched:Boolean(e(t))})})}}function y(...e){let n="string"==typeof e[0]?e[0]:void 0,i=2===e.length?e[1]:"string"==typeof e[0]?void 0:e[0];return{[t]:()=>({match(e){let t={[null!=n?n:r]:e};return{matched:void 0===i||o(i,e,(e,r)=>{t[e]=r}),selections:t}},getSelectionKeys:()=>[null!=n?n:r].concat(void 0===i?[]:a(i))})}}let h=f(function(e){return!0}),m=f(function(e){return"string"==typeof e}),v=f(function(e){return"number"==typeof e}),b=f(function(e){return"boolean"==typeof e}),g=f(function(e){return"bigint"==typeof e}),w=f(function(e){return"symbol"==typeof e}),T=f(function(e){return null==e});var O,A,C,M,N,F,L,j,S,I,_,P,E,D,B,k,K,U,V={__proto__:null,optional:d,array:u,intersection:s,union:c,not:p,when:f,select:y,any:h,_:h,string:m,number:v,boolean:b,bigint:g,symbol:w,nullish:T,instanceOf:function(e){return f(t=>t instanceof e)},typed:function(){return{array:u,optional:d,intersection:s,union:c,not:p,select:y,when:f}}};let G=e=>x(e,[]),x=(e,t)=>{let n=()=>{let r=t.find(({test:t})=>t(e));if(!r){let n;try{n=JSON.stringify(e)}catch(i){n=e}throw Error(`Pattern matching error: no pattern matches value ${n}`)}return r.handler(r.select(e),e)};return{with(...n){let i=n[n.length-1],a=[],l=[];3===n.length&&"function"==typeof n[1]?(a.push(n[0]),l.push(n[1])):a.push(...n.slice(0,n.length-1));let d={};return x(e,t.concat([{test:e=>Boolean(a.some(t=>o(t,e,(e,t)=>{d[e]=t}))&&l.every(t=>t(e))),handler:i,select:e=>Object.keys(d).length?r in d?d[r]:d:e}]))},when:(r,n)=>x(e,t.concat([{test:r,handler:n,select:e=>e}])),otherwise:r=>x(e,t.concat([{test:()=>!0,handler:r,select:e=>e}])).run(),exhaustive:()=>n(),run:n}},q=[D.Country,D.Province,D.City,D.District];function R(e){return q.indexOf(e)>=0}function z(e){return`${e}Code`}function W(e){for(let t=q.length-1;t>=0;--t)if(q[t]===e)return q[t-1]}function $(e){for(let t=0;t<q.length;++t)if(q[t]===e)return q[t+1]}function Z(e,t){if(e===t)return 1;let r=q.length-1;for(;r>=0;){let n=q[r];if(n===e)break;r-=1}if(r<0)return 0;let i=0;for(;i<q.length;){let o=q[i];if(o===t)break;i+=1}return i>=q.length||i>r?0:r-i+1}function H(e){return e?q.slice(1):[...q]}function J(){return{code:void 0,name:void 0}}function Y(e){return G(e).with(D.Country,()=>({propKey:D.Country,interactionType:k.Select,priority:7,displayOrder:7,display:!0,required:!0,title:"Country/region",placeholder:"Country/region",remindCopywriter:"Select a country / region"})).with(D.Province,()=>({propKey:D.Province,interactionType:k.Select,priority:8,displayOrder:8,display:!0,required:!0,title:"State/province",placeholder:"State/province",remindCopywriter:"Select a state / province"})).with(D.City,()=>({propKey:D.City,interactionType:k.Input,priority:6,displayOrder:6,display:!0,required:!0,title:"City",placeholder:"City",remindCopywriter:"Enter a city"})).with(D.District,()=>({propKey:D.District,interactionType:k.Input,priority:9,displayOrder:9,display:!1,required:!1,title:"District",placeholder:"District",remindCopywriter:"Enter a district"})).with(D.Address,()=>({propKey:D.Address,interactionType:k.Input,priority:4,displayOrder:4,display:!0,required:!0,title:"Address",placeholder:"Address",remindCopywriter:"Enter an address"})).with(D.Address2,()=>({propKey:D.Address2,interactionType:k.Input,priority:5,displayOrder:5,display:!0,required:!1,title:"Address2",placeholder:"Apartment, suite, etc. (optional)",remindCopywriter:""})).with(D.Name,()=>({propKey:D.Name,interactionType:k.Input,priority:1,displayOrder:1,display:!1,required:!1,title:"Name",placeholder:"Name",remindCopywriter:"Enter a name"})).with(D.FirstName,()=>({propKey:D.FirstName,interactionType:k.Input,priority:2,displayOrder:2,display:!0,required:!0,title:"First name",placeholder:"First name",remindCopywriter:"Enter a first name"})).with(D.LastName,()=>({propKey:D.LastName,interactionType:k.Input,priority:3,displayOrder:3,display:!0,required:!0,title:"Last name",placeholder:"Last name",remindCopywriter:"Enter a last name"})).with(D.Mobile,()=>({propKey:D.Mobile,interactionType:k.Input,priority:11,displayOrder:11,display:!0,required:!0,title:"Phone",placeholder:"Phone",remindCopywriter:"Enter a valid phone number"})).with(D.Postcode,()=>({propKey:D.Postcode,interactionType:k.Input,priority:9,displayOrder:9,display:!0,required:!0,title:"ZIP code",placeholder:"ZIP code",remindCopywriter:"ZIP code"})).with(D.Company,()=>({propKey:D.Company,interactionType:k.Input,priority:12,displayOrder:12,display:!1,required:!1,title:"Company",placeholder:"Company",remindCopywriter:"Company"})).otherwise(e=>({propKey:e,interactionType:k.Input,priority:-1,displayOrder:-1,display:!1,required:!1,title:e,placeholder:e,remindCopywriter:""}))}function Q(e){return!1!==e.display}function X(e){return e.interactionType===k.Select}function ee(e){return Object.assign(Object.assign({},e),{interactionType:k.Input})}function et(e){return Object.assign(Object.assign({},e),{interactionType:k.Select})}function er(){return{country:"DEFAULT",nameType:B.FLName,props:e.map(e=>Y(e))}}function en(e){let{country:t,nameType:r,props:n}=e,i=100,o=n.reduce((e,t)=>(e[t.propKey]=t,e),{}),a={forceFullNameMode:()=>(r=B.NAME,o[D.Name].display=!0,o[D.LastName].display=!1,o[D.FirstName].display=!1,a),forceFLNameMode:()=>(r=B.FLName,o[D.Name].display=!1,o[D.LastName].display=!0,o[D.FirstName].display=!0,a),hasField:e=>o.hasOwnProperty(e),setField(e){let{propKey:t}=e;return o.hasOwnProperty(t)||(o[t]=Object.assign(Object.assign({},e),{priority:i+=1})),a},build:()=>({country:t,nameType:r,props:Object.keys(o).map(e=>o[e]).sort((e,t)=>e.priority-t.priority)})};return a}function ei(e){return{success:!0,code:K.SUCCESS,data:e}}function eo(e,t,r){return{success:!1,code:e,msg:r}}function ea(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{d(n.next(e))}catch(t){o(t)}}function l(e){try{d(n.throw(e))}catch(t){o(t)}}function d(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,l)}d((n=n.apply(e,t||[])).next())})}function el(e,t){return G(e).with({type:"fieldUpdatedBlob",payload:V.select()},e=>e.candidates[0]).with({type:"fieldsUpdatedBlob",payload:V.select()},e=>e[t][0]).with({type:"addressInfoReplacedBlob",payload:V.select()},e=>e[t]||"").with({type:"addressInfoUpdatedBlob",payload:V.select()},e=>e[t]||"").otherwise(()=>"")}function ed(e,t,r){function n(e,t,r,i){if(!(i<1)&&Array.isArray(e)&&!(e.length<=0)){if(1===i){for(let o of e){let a=r(t,o);if(!1===a)break}return}for(let l of e)n(l.subNodes||[],t,r,i-1)}}let i={};return!function e(t,r,n){if(n<1)return;t(r);let i=$(r);i&&e(t,i,n-1)}(r=>{i[r]={traverse(i){!function(r,i){let o=Z(r,t);n(e,r,(e,t)=>{i(e,t)},o)}(r,i)},bailTraverse(i){!function(r,i){let o=Z(r,t);n(e,r,i,o)}(r,i)}}},t,r),i}function eu(){return{traverse(e){},bailTraverse(e){}}}function es(e,t){let r;if(null!=e)return e.bailTraverse((e,n)=>{if(n)for(let i=0;i<t.length;++i){let o=t[i];if(n.code===o)return r=n,!1}}),r||e.bailTraverse((e,n)=>{if(n)for(let i=0;i<t.length;++i){var o,a;let l=t[i];if(l&&(o=n.gCode||n.gcode||"",a=l.trim(),"string"==typeof o&&"string"==typeof a&&o.toLowerCase()===a.toLowerCase()))return r=n,!1}}),r||e.bailTraverse((e,n)=>{if(n)for(let i=0;i<t.length;++i){var o,a;let l=t[i];if(l&&(o=n.name||"",a=l.trim(),"string"==typeof o&&"string"==typeof a&&o.toLowerCase().indexOf(a.toLowerCase())>=0))return r=n,!1}}),r}(O=K||(K={})).SUCCESS="SUCCESS",O.FA_INVALID_PARAMS="FA_INVALID_PARAMS",O.FA_DOMAIN__INVALID_COUNTRY="FA_DOMAIN__INVALID_COUNTRY",O.FA_DOMAIN__INVALID_TEMPLATE="FA_DOMAIN__INVALID_TEMPLATE",(A=U||(U={}))[A.Nil=0]="Nil",A[A.Name=1]="Name",A[A.Logistics=2]="Logistics";let ec={[D.FirstName]:U.Name,[D.LastName]:U.Name,[D.Name]:U.Name,[D.Country]:U.Logistics,[D.Province]:U.Logistics,[D.City]:U.Logistics,[D.District]:U.Logistics,[D.Postcode]:U.Logistics};function ep(e,t){return{get country(){return e},get template(){return t},takeGroupModel:()=>ef(function(e){let{props:t}=e,r=t.slice(0).sort((e,t)=>e.priority-t.priority),n=[];return r.reduce((e,t,i)=>{let o=e[e.length-1],a=i===r.length-1;return o?e.length<3&&ec[o]&&ec[o]===ec[t.propKey]?(e.push(t.propKey),a&&n.push(e),e):(n.push(e),a&&n.push([t.propKey]),[t.propKey]):(a&&n.push([t.propKey]),[t.propKey])},[]),n}(t)),takeGroupModelWithStringifyTemplate:e=>ef(function*(e){let t=[],r={begin:-1,end:-1},n=(r,n)=>{let i=e.length-1;if(r<0||n<0||r>i||n>i||r>=n)return;let o=e.slice(r+1,n);o.length<=0||t.push(o)};for(let i=0;i<e.length;++i){let o=e[i];switch(o){case"{":r={begin:i,end:-1};break;case"}":r.end=i,n(r.begin,r.end);break;case"_":yield Array.from(t),t=[]}}t.length>0&&(yield Array.from(t))}(e))}}function ef(e){let t=[];for(let r of e)t.push({type:"Group",elements:r.map(e=>("address1"===e&&(e=D.Address),{type:"Element",fieldName:e}))});return{prependGroup(...e){let r=new Set(e);(t=em(t,e=>!r.has(e))).unshift(ey(e))},insertGroupBefore(e,...r){let n=new Set(r);t=em(t,e=>!n.has(e));let i=-1;t.forEach((t,r)=>{t&&"Group"===t.type&&t.elements.forEach(t=>{"Element"===t.type&&t.fieldName===e&&(i=r)})}),(i<0||i>=t.length)&&(i=t.length),t=[...t.slice(0,i),ey(r),...t.slice(i)]},build(){let e=[];return t.forEach(t=>{"Group"===t.type&&e.push(t.elements.map(e=>e.fieldName))}),e}}}function ey(e){return{type:"Group",elements:e.map(eh)}}function eh(e){return{type:"Element",fieldName:e}}function em(e,t){let r=[];return e.forEach(e=>{if(e&&"Group"===e.type){let n=function(e,t){if(!e)return null;let r=[];return(e.elements.forEach(e=>{e&&t(e.fieldName)&&r.push(e)}),r.length<=0)?null:{type:"Group",elements:r}}(e,t);n&&r.push(n)}}),r}function ev(e,t){return e.levelValueMap[t]}function eb(e,t){return e.infoFieldSet.has(t)?e.infoFieldValueMap[t]:void 0}function eg(e,t){switch(t){case D.FirstName:case D.LastName:return e.addressTemplateNameMode===B.FLName;case D.Name:return e.addressTemplateNameMode===B.NAME;default:return!0}}var ew={initDomainState:function(e){let t={addressTemplate:e.addressTemplate,addressTemplateNameMode:e.addressTemplate.nameType,fieldLayoutGroup:e.fieldLayoutGroup,fieldTemplateMap:{},levelValueMap:q.reduce((e,t)=>(e[t]={code:void 0,name:void 0},e),{}),levelAddressBookTraverserMap:q.reduce((e,t)=>(e[t]=eu(),e),{}),infoFieldSet:new Set,infoFieldValueMap:{}};return e.addressTemplate.props.forEach(e=>{G(e).with({propKey:V.union(...q)},e=>{t.fieldTemplateMap[e.propKey]=e}).otherwise(e=>{t.infoFieldSet.add(e.propKey),t.fieldTemplateMap[e.propKey]=e})}),t},withLevelField:function(e,t,r){let[n,i,o]=r([e.fieldTemplateMap[t],e.levelValueMap[t],e.levelAddressBookTraverserMap[t]]);if(e=Object.assign({},e),X(n)&&o[t]){e.levelAddressBookTraverserMap=Object.assign(Object.assign({},e.levelAddressBookTraverserMap),o);let a=es(o[t],[i.code,i.name]);a||(i=J())}else i=Q(n=ee(n))?Object.assign(Object.assign({},J()),{name:i.name}):Object.assign({},J()),function(e,t){let r=!1;for(let n=0;n<q.length;++n)q[n]===t&&(r=!0),r&&e(q[n])}(t=>{var r;e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:ee(null===(r=e.fieldTemplateMap)||void 0===r?void 0:r[t])})},t);return e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:n}),e.levelValueMap=Object.assign(Object.assign({},e.levelValueMap),{[t]:i}),e},withInfoField:function(e,t,r){let[n,i]=r([e.fieldTemplateMap[t]||Y(t),e.infoFieldValueMap[t]]);return(e=Object.assign({},e)).infoFieldSet.has(t)||(e.infoFieldSet=new Set(e.infoFieldSet),e.infoFieldSet.add(t)),e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:n}),e.infoFieldValueMap=Object.assign(Object.assign({},e.infoFieldValueMap),{[t]:Q(n)?i:null}),e},isNameModeMatched:eg,getLevelInfo:ev,getCountryCode:function(e){return ev(e,D.Country).code},getInfoFieldValue:eb,getAddressInfo:function(e){let t={};for(let r of e.infoFieldSet){let n=eb(e,r)||"";switch(r){case D.Name:eg(e,D.Name)&&(t[D.Name]=n);break;case D.LastName:case D.FirstName:eg(e,r)&&(t[r]=n);break;default:t[r]=n}}return H().forEach(r=>{let n=ev(e,r);t[z(r)]=n.code||"",t[r]=n.name||""}),t},getFieldTemplateLayout:function(e){let t=new Set,r={};for(let n of e.fieldLayoutGroup){let i=[];n.forEach(r=>{e.fieldTemplateMap[r]&&(eg(e,r)||r!==D.LastName||(r=D.Name),Q(e.fieldTemplateMap[r])&&eg(e,r)&&(t.has(r)&&t.delete(r),t.add(r),i.push(r)))}),r=Object.assign(Object.assign({},r),function(e){let t={},r=[],n=[];return(e||[]).forEach((e,t)=>{let i=Math.floor(t/3),o=Math.floor(t/3);null==r[i]?r[i]=1:r[i]+=1,null==n[o]?n[o]=1:n[o]+=1}),(e||[]).forEach((e,i)=>{null==t[e]&&(t[e]={xs:24,md:24/(r[Math.floor(i/3)]||1),xl:24/(n[Math.floor(i/3)]||1)})}),t}(i))}let o=[];return[...e.infoFieldSet,...H()].forEach(e=>{t.has(e)||o.push(e)}),{get fieldTemplateLayout(){return r},get fieldTemplateSequence(){return[...t,...o.sort((t,r)=>e.fieldTemplateMap[t].priority-e.fieldTemplateMap[r].priority)]}}}};function eT(e){function t(t,r){return ea(this,void 0,void 0,function*(){let n,i,o=er(),a=yield e.getAddressTemplate(t||"DEFAULT");if(a.success&&(o=a.data),"function"==typeof(null==r?void 0:r.addressTemplateDecorator)){let l=en(o);r.addressTemplateDecorator(l),o=l.build()}return{addressTemplate:o,fieldLayoutGroup:(i=ep(t,o),"function"==typeof(null==r?void 0:r.fieldLayoutGroupDecorator)&&(n=r.fieldLayoutGroupDecorator(i)),n||(n=i.takeGroupModel()),n.build())}})}return{reduce(r,n,i){return ea(this,void 0,void 0,function*(){let o;if(i.isClean())return ei(r);let a=yield e.getCountryList();if(!a.success||a.data.length<=0){let l=yield t("DEFAULT",n);o=ew.initDomainState({addressTemplate:l.addressTemplate,fieldLayoutGroup:l.fieldLayoutGroup}),o=ew.withLevelField(o,D.Country,([e])=>[e,J(),ed([],D.Country,1)])}else{let d=ed(a.data.map(e=>({name:e.name,code:e.code,alias:"",pCode:"",gCode:e.code,zipCode:[]})),D.Country,1),u=i.diffAddressFieldInfo(D.Country);if("Changed"===u.type){let s=G(u.payload).with({type:"fieldUpdatedBlob",payload:V.select()},e=>e.candidates[0]).with({type:"fieldsUpdatedBlob",payload:V.select()},e=>e[D.Country][0]).with({type:"addressInfoReplacedBlob",payload:V.select()},e=>e.countryCode||"").with({type:"addressInfoUpdatedBlob",payload:V.select()},e=>e.countryCode||"").otherwise(()=>""),c=s?a.data.find(e=>e.code===s):null;if(null==c){let p=yield t("DEFAULT",n);o=ew.initDomainState({addressTemplate:p.addressTemplate,fieldLayoutGroup:p.fieldLayoutGroup}),o=ew.withLevelField(o,D.Country,([e])=>[e,J(),d])}else{let f=yield t(c.code,n);o=ew.initDomainState({addressTemplate:f.addressTemplate,fieldLayoutGroup:f.fieldLayoutGroup}),o=ew.withLevelField(o,D.Country,([e])=>[e,c,d])}}else{let y=yield t(ew.getCountryCode(r),n);o=ew.initDomainState({addressTemplate:y.addressTemplate,fieldLayoutGroup:y.fieldLayoutGroup}),o=ew.withLevelField(o,D.Country,([e])=>[e,r.levelValueMap[D.Country],d])}}for(let h of H(!0))o=yield function(t,r,n,i){return ea(this,void 0,void 0,function*(){let o=r.fieldTemplateMap[n],a=i.diffAddressFieldInfo(n);if(!X(o))return ew.withLevelField(r,n,([e])=>[ee(e),G(a).with({type:"Changed",payload:V.select()},e=>Object.assign(Object.assign({},J()),{name:el(e,n)})).otherwise(()=>X(t.fieldTemplateMap[n])?J():Object.assign(Object.assign({},t.levelValueMap[n]),{code:void 0})),{}]);if(!Q(o))return r;let l=function(e,t){let r=1,n=W(t);for(;null!=n;){let i=e.fieldTemplateMap[n];if(!X(i))break;if(Q(i))return{fieldName:n,addressCode:e.levelValueMap[n].code||"",depth:r};r+=1,n=W(n)}return null}(r,n);if(null==l)return ew.withLevelField(r,n,([e])=>[ee(e),G(a).with({type:"Changed",payload:V.select()},e=>Object.assign(Object.assign({},J()),{name:el(e,n)})).otherwise(()=>Object.assign(Object.assign({},t.levelValueMap[n]),{code:void 0})),{}]);let d=ew.getCountryCode(r);if(!d||!l.addressCode)return ew.withLevelField(r,n,([e])=>[et(e),J(),{[n]:eu()}]);let u=yield e.getAddressBook(d,l.fieldName,l.addressCode,l.depth);if(!u.success||u.data.length<=0)return ew.withLevelField(r,n,([e])=>[ee(e),G(a).with({type:"Changed",payload:V.select()},e=>Object.assign(Object.assign({},J()),{name:el(e,n)})).otherwise(()=>Object.assign(Object.assign({},t.levelValueMap[n]),{code:void 0})),{}]);let s=ed(u.data,$(l.fieldName),l.depth);return ew.withLevelField(r,n,([e])=>[et(e),G(a).with({type:"Changed",payload:V.select()},e=>{let t=es(s[n],G(e).with({type:"fieldUpdatedBlob",payload:V.select()},e=>e.candidates).with({type:"fieldsUpdatedBlob",payload:V.select()},e=>e[n]||[]).with({type:V.union("addressInfoUpdatedBlob","addressInfoReplacedBlob"),payload:V.select()},e=>[R(n)&&e[z(n)]||"",e[n]||""]).otherwise(()=>[]));return t?{code:t.code,name:t.name}:J()}).otherwise(()=>{let e=ew.getLevelInfo(t,n),r=es(s[n],[e.code,e.name]);return r?{code:r.code,name:r.name}:J()}),s])})}(r,o,h,i);for(let m of H(!0).reverse())o=yield function(e,t,r,n){return ea(this,void 0,void 0,function*(){if(!function(e,t,r,n){let i=t.fieldTemplateMap[r];if(!X(i)||Q(i))return!1;let o=$(r);if(!o)return!1;let a=t.fieldTemplateMap[o];return X(a)&&!!ew.getLevelInfo(t,o).code}(0,t,r))return t;let e=$(r);if(!e)return t;let n=ew.getLevelInfo(t,e),i=es(t.levelAddressBookTraverserMap[e],[n.code]);if(!i)return t;let o=i.parentCode||i.pCode||i.pcode;if(!o)return t;let a=es(t.levelAddressBookTraverserMap[r],[o]);return a?ew.withLevelField(t,r,([e,t,n])=>[e,{code:a.code,name:a.name},{[r]:n}]):t})}(0,o,m);for(let v of o.infoFieldSet)o=yield function(e,t,r,n,i){return ea(this,void 0,void 0,function*(){let o=n.diffAddressFieldInfo(r);return ew.withInfoField(t,r,([t,n])=>{if("function"==typeof(null==i?void 0:i.fieldTemplateDecorator)){let a=i.fieldTemplateDecorator(r,t);null!=a&&(t=Object.assign(Object.assign({},t),{display:a.display}))}return[t,G(o).with({type:"Changed",payload:V.select()},e=>el(e,r)).otherwise(()=>ew.getInfoFieldValue(e,r))]})})}(r,o,v,i,n);return ei(o=yield function(e,t,r){return ea(this,void 0,void 0,function*(){if(!function(e,t){if(ew.getInfoFieldValue(e,D.Postcode))return!1;let r=t.diffAddressFieldInfo(D.Postcode);return G(r).with({type:"Changed",payload:V.select()},e=>G(e).with({type:V.union("fieldUpdatedBlob","fieldsUpdatedBlob")},e=>!1).otherwise(()=>!0)).otherwise(()=>!0)}(t,r))return t;let e=D.District;do{if(null!=e&&X(t.fieldTemplateMap[e])){let n=es(t.levelAddressBookTraverserMap[e],[ew.getLevelInfo(t,e).code]);if(n){"string"==typeof n.zipCode&&n.zipCode?t.infoFieldValueMap[D.Postcode]=n.zipCode:Array.isArray(n.zipCode)&&n.zipCode[0]&&(t.infoFieldValueMap[D.Postcode]=n.zipCode[0]);break}}e=W(e)}while(e);return t})}(0,o,i))})}}}function eO(e,t){let r=ew.getFieldTemplateLayout(e),n={get addressInfo(){return ew.getAddressInfo(e)},get addressTemplate(){return e.addressTemplate},get fieldTemplateMap(){return Object.assign({},e.fieldTemplateMap)},get fieldAddressBookTraverser(){return Object.assign({},e.levelAddressBookTraverserMap)},fieldTemplateLayout:r.fieldTemplateLayout,fieldTemplateSequence:r.fieldTemplateSequence,get fieldAddressBookMap(){return H().reduce((t,r)=>{let n=e.levelAddressBookTraverserMap[r];return Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get(){let e=[];return n&&n.traverse((t,r)=>{let n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}(r,["subNodes"]);e.push(n)}),e}}),t},{})},traverseAddressLevelField(t){H().forEach(r=>t(r,e.fieldTemplateMap[r]))},traverseAddressInfoField(t){e.infoFieldSet.forEach(r=>t(r,e.fieldTemplateMap[r]))},traverseAddressField(e){n.traverseAddressLevelField(e),n.traverseAddressInfoField(e)},bailTraverseAddressLevelField(t,r){let n=H();for(let i=0;i<n.length;++i){let o=n[i],a=t(o,e.fieldTemplateMap[o]);if(void 0!==a)return a}return r}};return n}function eA(e){let t,r;return function(...n){if(t&&function e(t,r){if(t===r)return!0;if(null==t||null==r)return!1;let n=typeof t;if(n!==typeof r||"function"===n)return!1;if(Array.isArray(t)&&Array.isArray(r)){let i=t.length,o=r.length;if(i!==o)return!1;let a=0;for(;a<i;++a){let l=t[a],d=r[a];if(!e(l,d))return!1}return a===o}return!1}(t,n)&&r)return r;t=n,r=void 0;let i=e.apply(this,n);return r=i,i&&"object"==typeof i&&(i instanceof Promise||"function"==typeof i.then)&&i&&"object"==typeof i&&(i instanceof Promise||"function"==typeof i.catch)&&i.catch(e=>{t===n&&r===i&&(t=void 0,r=void 0)}),i}}function eC(e){let t=function(e){return{getAddressTemplate:eA(t=>ea(this,void 0,void 0,function*(){let r=yield e.getAddressTemplate(t).catch(e=>(console.error("failed to get getAddressTemplate",e),eo("FA_ADDRESS_UNKNOWN")));return r.success?Object.assign(Object.assign({},r),{data:Object.assign(Object.assign({},r.data),{props:r.data.props.map(e=>"address1"===e.propKey?Object.assign(Object.assign({},e),{propKey:D.Address}):e)})}):r}))}}(e.addressTemplateFetcher),r=function(e){let t={};return{getAddressBook(r,n,i,o){let a=function(r,n,i,o){let a=`${r}__${n}__${o||1}`;return null==t[a]&&(t[a]={getAddressBook:eA((t,r,n,i)=>e.getAddressBook(t,r,n,i).catch(e=>(console.error("failed to get getAddressBook",e),eo("FA_ADDRESS_UNKNOWN"))))}),t[a]}(r,n,0,o);return a.getAddressBook(r,n,i,o)}}}(e.addressBookFetcher),n=function(e){let t=eA(e.getCountryList);return{getCountryList:()=>t().catch(e=>(console.error("failed to get getCountryList",e),eo("FA_ADDRESS_UNKNOWN")))}}(e.countrySource);return{get port(){return Object.assign(Object.assign(Object.assign({},n),t),r)}}}let eM="Defer",eN="Blocking";var eF="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},eL={},ej={},eS={},eI=eF&&eF.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{d(n.next(e))}catch(t){o(t)}}function l(e){try{d(n.throw(e))}catch(t){o(t)}}function d(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,l)}d((n=n.apply(e,t||[])).next())})},e_=eF&&eF.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}};Object.defineProperty(eS,"__esModule",{value:!0});var eP=new Promise(function(e){});eS.default={zombie:eP,resolvable:function(){var e,t=!1;return[new Promise(function(r){t?r():e=r}),function(){t=!0,"function"==typeof e&&e()}]},resolveAfterEventBubbled:function(e,t){return eI(this,void 0,void 0,function(){return e_(this,function(r){return[2,new Promise(function(r){var n=function(i){e.removeEventListener(t,n),r(i)};e.addEventListener(t,n)})]})})},resolveAfterSeconds:function(e){return eI(this,void 0,void 0,function(){return e_(this,function(t){return e<=0?[2,Promise.resolve()]:[2,new Promise(function(t){setTimeout(function(){t()},1e3*e)})]})})},resolveAfterDuration:function(e){return eI(this,void 0,void 0,function(){return e_(this,function(t){return e<=0?[2,Promise.resolve()]:[2,new Promise(function(t){setTimeout(function(){t()},e)})]})})}};var eE={};Object.defineProperty(eE,"__esModule",{value:!0});var eD=function(){function e(e){this.v=e}return Object.defineProperty(e.prototype,"timestamp",{get:function(){return this.v},enumerable:!1,configurable:!0}),e.prototype.add=function(t){return new e(this.v+t)},e.prototype.sub=function(t){return new e(this.v-t)},e.prototype.duration=function(e){return this.v-e.timestamp},e}();function eB(e){return new eD(e)}function ek(){return eB(Date.now())}eE.default={time:eB,now:ek,later:function(e){return ek().add(e)},former:function(e){return ek().sub(e)},Millisecond:1,Second:1e3,Minute:6e4,Hour:36e5,Day:864e5,Week:6048e5};var eK={};Object.defineProperty(eK,"__esModule",{value:!0}),eK.default={errCanceled:"context done with cancellation",errTimeout:"context done with timeout",errDeadline:"context done with deadline",errNotNullableValuer:"valuer is not nullable"};var eU=eF&&eF.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ej,"__esModule",{value:!0});var eV=eU(eS),eG=eU(eE),ex=eU(eK);function eq(){return{deadline:function(){return null},done:function(){return eV.default.zombie},err:function(){return null},value:function(e){return e?e.defaultGetter():null}}}function eR(e){return e||(e=eW),{deadline:function(){return e.deadline()},done:function(){return e.done()},err:function(){return e.err()},value:function(t){return e.value(t)}}}function ez(e){var t=eV.default.resolvable(),r=t[0],n=t[1],i=null;return[{deadline:function(){return e.deadline()},done:function(){return Promise.race([e.done().then(function(){return e.err()}),r.then(function(){return Error(ex.default.errCanceled)})]).then(function(e){i=e})},err:function(){return i},value:function(t){return e.value(t)}},n]}ej.default={background:function(){return eR(eW)},todo:function(){return eR(e$)},withValue:function(e,t,r){return{deadline:function(){return e.deadline()},done:function(){return e.done()},err:function(){return e.err()},value:function(n){return t===n?r:e.value(n)}}},withCancel:function(e){return ez(e)},withTimeout:function(e,t){var r,n,i;return ez((n=eG.default.later(t),i=eV.default.resolveAfterDuration(t),{deadline:function(){return n},done:function(){return Promise.race([e.done().then(function(){return e.err()}),i.then(function(){return Error(ex.default.errTimeout)})]).then(function(e){r=e})},err:function(){return r},value:function(t){return e.value(t)}}))},withDeadline:function(e,t){var r,n;return ez((r=null,n=eV.default.resolveAfterDuration(t.duration(eG.default.now())),{deadline:function(){return t},done:function(){return Promise.race([e.done().then(function(){return e.err()}),n.then(function(){return Error(ex.default.errDeadline)})]).then(function(e){r=e})},err:function(){return r},value:function(t){return e.value(t)}}))}};var eW=eq(),e$=eq(),eZ={},eH=eF&&eF.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(eZ,"__esModule",{value:!0});var eJ=eH(eK);function eY(e){return Object.defineProperty({},"defaultGetter",{value:e,writable:!1,configurable:!1})}eZ.default={newValuer:function(e){return eY(void 0===e?function(){throw Error(eJ.default.errNotNullableValuer)}:function(){return e})},newValuerWithGetter:function(e){return"function"!=typeof e&&(e=function(){throw Error(eJ.default.errNotNullableValuer)}),eY(e)}},C=eL,M=eF&&eF.__assign||function(){return(M=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},N=eF&&eF.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),F=eF&&eF.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||N(t,e,r)},L=eF&&eF.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},Object.defineProperty(C,"__esModule",{value:!0}),j=L(ej),S=L(eK),I=L(eZ),F(ej,C),F(eZ,C),C.default=M(M(M({},S.default),j.default),I.default);var eQ=eL&&eL.__esModule&&Object.prototype.hasOwnProperty.call(eL,"default")?eL.default:eL;window["@sl/address-component"]={createHost:function(e){var t,r,n;let i;let o=en((null===(t=null==e?void 0:e.initState)||void 0===t?void 0:t.addressTemplate)||er());"function"==typeof(null===(r=null==e?void 0:e.initProps)||void 0===r?void 0:r.addressTemplateDecorator)&&e.initProps.addressTemplateDecorator(o);let a=o.build(),l=ep(a.country,a);"function"==typeof(null===(n=null==e?void 0:e.initProps)||void 0===n?void 0:n.fieldLayoutGroupDecorator)&&(i=null==e?void 0:e.initProps.fieldLayoutGroupDecorator(l)),null==i&&(i=l.takeGroupModel());let d=ew.initDomainState({addressTemplate:a,fieldLayoutGroup:i.build()}),u=e.initProps||{},s=eO(d),c=eC(e.adapter),p=function(){let e=new Set;return{next(t){e.forEach(e=>{"function"==typeof e&&e(t)})},subscribe:t=>(e.add(t),{unsubscribe(){e.delete(t)}})}}(),f=eT(c.port),y=function(e){let t=[],r=[],n=function(e,t){var r;let n={pending:!1,scheduled:!1},i=(r=()=>{n.pending=!1,o()},{tick(e){e().finally(()=>{r()})}}),o=()=>{!n.pending&&n.scheduled&&(n.scheduled=!1,n.pending=!0,i.tick(e))};return{tick(e){switch(e){case eM:var r;n.scheduled=!0,setTimeout(()=>{o()},("number"!=typeof(r=null==t?void 0:t.deferTimeout)&&(r=Number(r)),(r!=r||r<0)&&(r=10),r));return;case eN:n.scheduled=!0,o();return;default:return}}}}(()=>ea(this,void 0,void 0,function*(){let n=t.slice(0);for(;n.length>0;)yield e(n),t.splice(0,n.length),n=t.slice(0);r.splice(0).forEach(e=>{"function"==typeof e&&e()})}),{deferTimeout:10});return{add(e){console.debug("add address blob stream",JSON.stringify(e,null,2)),t.push(e),G(G(e).with({type:V.union("addressInfoReplacedBlob","addressInfoUpdatedBlob","fieldsUpdatedBlob")},e=>eN).with({type:"fieldUpdatedBlob",payload:V.select()},e=>Reflect.has(e,D.Country)?eN:eM).otherwise(()=>eM)).with(eN,()=>n.tick(eN)).otherwise(()=>n.tick(eM))},exhaust:()=>t.length<=0?Promise.resolve():new Promise(e=>{r.push(e)})}}(e=>ea(this,void 0,void 0,function*(){let t=function(e){var t;let r=(t=e.reverse(),function(e){for(let r of t){let n=e(r);if(void 0!==n)return n}});function n(e){return void 0!==e?{type:"Changed",payload:e}:{type:"Clean"}}return{isClean:()=>e.length<=0,diffDomainProps:()=>n(r(e=>G(e).with({type:"domainPropsUpdatedBlob"},e=>e).otherwise(()=>void 0))),diffAddressFieldInfo:e=>n(r(t=>G(t).with({type:"fieldUpdatedBlob",payload:{fieldName:e}},e=>e).with({type:"fieldsUpdatedBlob"},({payload:t})=>null!=t[e],e=>e).with({type:"addressInfoUpdatedBlob"},({payload:t})=>R(e)&&null!=t[z(e)]||null!=t[e],e=>e).with({type:"addressInfoReplacedBlob"},e=>e).otherwise(()=>void 0)))}}(e),r=u,n=t.diffDomainProps();"Changed"===n.type&&(r=n.payload.payload);let i=yield f.reduce(d,r,t);i.success?(d=i.data,s=eO(i.data),p.next(s),u=r):p.next(s)})),h={init(){var t;return y.add({type:"addressInfoReplacedBlob",payload:(null===(t=e.initState)||void 0===t?void 0:t.addressInfo)||{}}),h.exhaustModel()},getModel:()=>s,exhaustModel:()=>y.exhaust().then(()=>s),observeModel:(e,t)=>(!0===t&&setTimeout(()=>{e(s)},0),p.subscribe(e)),updateAdapter(e){h.exhaustModel().finally(()=>{f=eT((c=eC(e)).port),h.updateFieldsValue({})})},updateProps(e){let t;t="function"==typeof e?e(u):e,y.add({type:"domainPropsUpdatedBlob",payload:t})},updateFieldValue(e,...t){y.add({type:"fieldUpdatedBlob",payload:{fieldName:e,candidates:t}})},updateFieldsValue(e){y.add({type:"fieldsUpdatedBlob",payload:Object.keys(e).reduce((t,r)=>(t[r]=[e[r]],t),{})})},updateFieldsValueWithCandidates(e){y.add({type:"fieldsUpdatedBlob",payload:Object.keys(e).reduce((t,r)=>(t[r]=e[r],t),{})})},updateAddressInfo(e){y.add({type:"addressInfoUpdatedBlob",payload:e})},clearAddressInfo(){y.add({type:"addressInfoReplacedBlob",payload:{}})},replaceAddressInfo(e){y.add({type:"addressInfoReplacedBlob",payload:e})}};return h},distinctUntil:function(e,t,r,n){var i;let o,[a,l]=eQ.withCancel(eQ.background()),[d,u]=eQ.withCancel(a),s=(i=([e,n])=>{if("function"==typeof t&&t(e,n)){let[i,o]=eQ.withCancel(a);u(),d.done().finally(()=>{r(i,n)}),d=i,u=o}},e.observeModel(e=>{let t=(null==o?void 0:o.addressInfo)||{},r=e.addressInfo,n=new Set(Object.keys(t)),a=new Set(Object.keys(r)),l={};a.forEach(e=>{n.has(e)&&t[e]===r[e]||(l[e]=r[e]||null),n.delete(e)}),n.forEach(e=>{l[e]=null}),i([o,e,l]),o=e},n));return a.done().finally(()=>{s.unsubscribe()}),{unsubscribe(){l()}}},"/domain-model":{FieldNameEnum:D,FieldInteractionEnum:k}}}();
